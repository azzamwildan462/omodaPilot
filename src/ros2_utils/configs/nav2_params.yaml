#######################################
# PLANNER SERVER â€” Smac Hybrid-A*
#######################################
planner_server:
  ros__parameters:
    use_sim_time: false
    expected_planner_frequency: 5.0

    planner_plugins: ["SmacHybrid"]

    SmacHybrid:
      plugin: "nav2_smac_planner/SmacPlannerHybrid"

      # --- global planning ---
      tolerance: 0.5 # toleransi jarak ke goal (m)
      downsample_costmap: true
      downsampling_factor: 1
      allow_unknown: true
      maximum_planning_time: 0.5 # s
      use_astar: false # Hybrid-A*, bukan A* vanilla
      cache_obstacle_heuristic: true
      lookup_table_size: 20.0

      # --- Ackermann / SE2 config ---
      motion_model_for_search: "DUBIN" # bisa maju-mundur, hormat kinematik
      angle_quantization_bins: 64 # resolusi heading

      # TODO: ganti sesuai fisik mobil
      minimum_turning_radius: 4.0 # meter (wheelbase & max steering angle)

      # penalty (bisa di-tuning belakangan)
      reverse_penalty: 2.0
      non_straight_penalty: 1.2
      change_penalty: 0.0
      rotation_penalty: 4.0
      cost_penalty: 2.0
      retrospective_penalty: 0.02

#######################################
# GLOBAL COSTMAP (dipakai planner_server)
#######################################
global_costmap:
  global_costmap:
    ros__parameters:
      use_sim_time: false
      global_frame: map
      robot_base_frame: base_link

      update_frequency: 5.0
      publish_frequency: 2.0
      resolution: 0.05

      # --- footprint mobil (contoh) ---
      # Asumsi: panjang ~1.2 m, lebar ~0.7 m, base_link dekat axle belakang
      footprint: [[1.0, 0.35], [1.0, -0.35], [-0.2, -0.35], [-0.2, 0.35]]
      footprint_padding: 0.03

      # kalau pakai footprint, robot_radius = 0
      robot_radius: 0.0

      track_unknown_space: true
      rolling_window: false
      width: 80 # 80 * 0.05 = 4 m (sesuaikan dengan area map)
      height: 80

      plugins: ["static_layer", "obstacle_layer", "inflation_layer"]

      static_layer:
        plugin: "nav2_costmap_2d::StaticLayer"
        map_subscribe_transient_local: true # latched /map

      obstacle_layer:
        plugin: "nav2_costmap_2d::ObstacleLayer"
        observation_sources: scan
        scan:
          topic: /laserscan # sesuaikan dengan topic LIDAR kamu
          data_type: LaserScan
          marking: true
          clearing: true
          max_obstacle_height: 2.0

      inflation_layer:
        plugin: "nav2_costmap_2d::InflationLayer"
        inflation_radius: 0.8
        cost_scaling_factor: 3.0
